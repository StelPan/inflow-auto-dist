import{u as k}from"./vue-router-e112b3e0.js";import{_ as I,m as u,g as j,h as $,c as m,p as x,B as D,t as w,f,b as g,a as y,x as F,k as L}from"./_plugin-vue_export-helper-4e0f1051.js";import{s as N}from"./button.esm-48574c78.js";import{s as P}from"./progressspinner.esm-2138ab26.js";import{r as b}from"./index-9063c430.js";import{F as T}from"./FormLayout-06a8a99e.js";import{o as W}from"./principalDeals-5bcfc342.js";import{u as q}from"./Api-3d31057e.js";const E={props:{nameSection:{type:String,required:!0}},setup(){const{params:{projectID:o,dealID:a}}=k(),t=a==="create"?"Создание сделки":`Сделка № ${a}`;return{projectID:o,dealID:a,title:t}}},V={class:"flex"};function M(o,a,t,e,l,i){const s=u("router-link");return f(),j("div",V,[$("h2",null,[m(s,{to:`/projects/${e.projectID}/deals/${e.dealID}`,class:"p-link-subject"},{default:x(()=>[D(w(e.title),1)]),_:1},8,["to"]),D(" / "+w(t.nameSection),1)])])}const Y=I(E,[["render",M],["__file","/var/www/inflow-auto-front-main/src/views/deals/components/TitleBox.vue"]]),O={components:{ProgressSpinner:P,FormLayout:T,Button:N},props:{data:{type:Object,required:!0},apiMethod:{type:Function,required:!0}},emits:["updateError"],setup(o,{emit:a}){var S;const t=k(),{principalState:e}=q(),l=(S=t.name)==null?void 0:S.toString().split("/")[2],i=t.params.projectID,s=g(()=>t.params.dealID),d=g(()=>t.params.dealID==="create"),r=y(!1),n=y(!1),_=["photos"].includes(l),B=_?["выгрузка","Выгрузить"]:["сохранение","Сохранить"],C=async()=>{var c;r.value=!0,n.value=!0;const p=await W(i);if(p.success){const h=(c=p.data)==null?void 0:c.id;await b.push(`/projects/${i}/deals/${h||s}/${l}`),v(h)}else r.value=!1,n.value=!1},v=async p=>{r.value=!0;const c=await o.apiMethod(p||s.value,o.data);c.success?_||b.push(`/projects/${i}/deals/${s.value}`):a("updateError",{isShow:!0,response:c}),r.value=!1};return{handleCreateDeal:C,handleSubmit:v,isSaving:r,isCreate:d,actionLabel:B,route:t,principalState:e,isNoSpinner:n}}},R={key:0,class:"p-4 flex align-content-center justify-content-center"};function z(o,a,t,e,l,i){var n;const s=u("ProgressSpinner"),d=u("Button"),r=u("FormLayout");return!e.isCreate&&((n=e.principalState.deal)==null?void 0:n.data.id)!==Number(e.route.params.dealID)&&!e.isNoSpinner?(f(),j("div",R,[m(s,{strokeWidth:"1",animationDuration:".5s"})])):(f(),F(r,{key:1,class:"p-container"},{default:x(()=>[L(o.$slots,"default"),m(d,{type:"submit",onClick:a[0]||(a[0]=()=>e.isCreate?e.handleCreateDeal():e.handleSubmit()),label:e.isSaving?`Идет ${e.actionLabel[0]}`:e.actionLabel[1],loading:e.isSaving},null,8,["label","loading"])]),_:3}))}const Z=I(O,[["render",z],["__file","/var/www/inflow-auto-front-main/src/views/deals/components/Wrap.vue"]]);export{Y as T,Z as W};
