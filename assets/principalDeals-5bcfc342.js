var D=Object.defineProperty,h=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var $=(s,e,t)=>e in s?D(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,u=(s,e)=>{for(var t in e||(e={}))A.call(e,t)&&$(s,t,e[t]);if(g)for(var t of g(e))S.call(e,t)&&$(s,t,e[t]);return s},_=(s,e)=>h(s,C(e));import{A as m}from"./index.es-55ebbfbf.js";import{d as l}from"./dayjs.min-18f6db6c.js";import{A as n,u as y}from"./Api-3d31057e.js";import{r as f}from"./DateTime-6dd15e58.js";async function M(s){var a;const e={};s.query.start_date&&(e.start_date=l(f(s.query.start_date)).format("YYYY-MM-DD")),s.query.end_date&&(e.end_date=l(f(s.query.end_date)).format("YYYY-MM-DD"));const t=new URLSearchParams(_(u({},e),{page:Number(s.query.page)+1||1,per_page:s.query.per_page||15,company:(a=s.params)==null?void 0:a.projectID})).toString();try{const o=await n.get(`deals?${t}`),{principalStore:p}=y();p.dispatch(async i=>{var d,w;i.deals={data:((d=o.data)==null?void 0:d.data)||[],isLoading:!1,pagination:(w=o.data)==null?void 0:w.pagination}})}catch(o){console.log("error",o)}}async function c(s){try{const e=await n.get(`deals/${s}`),{principalStore:t}=y();if(e.data){const a=e.data;if(a.car&&(a.car.deregistered=a.car.deregistered?1:0,a.car.pts_date=f(a.car.pts_date),a.car.sts_date=f(a.car.sts_date)),a.inspection_time){const o=a.inspection_time.split(":");a.inspection_time=`${l().hour(Number(o[0])).minute(Number(o[1]))}`}a.owner&&(a.owner=u(u({},a.owner),a.owner.data),delete a.owner.data,a.owner.is_signer=a.owner.is_signer?"1":"0")}return t.dispatch(async a=>{a.deal={data:e.data||{},isLoading:!1}}),e.data}catch(e){console.log("error",e)}}async function r(s){const{principalStore:e}=y();e.dispatch(async a=>{a.overview={data:{},isLoading:!0}});const t=await n.get(`deals/${s}/overview`);return t.error&&m({title:"Внимание!",text:t.error||t.message,type:"error"}),e.dispatch(async a=>{a.overview={data:t.data||{},status:t.status,isLoading:!1}}),t}async function x(s){return await n.post("deals",{company_id:s})}async function L(s,e){return e.deregistered==1?(delete e.sts_series,delete e.sts_number,delete e.sts_date,delete e.sts_issuer):e.deregistered=0,await n.post(`deals/${s}/add-car`,e)}async function j(s,e){return delete e.id,await n.post(`deals/${s}/owner-data`,e)}async function k(s,e){return await n.post(`deals/${s}/cost/declared`,e)}async function O(s,e){return await n.post(`deals/${s}/cost/deal`,e)}async function b(s,e){return await n.post(`deals/${s}/address`,e)}async function B(s,e){return await n.post(`deals/${s}/comment`,e)}async function N(s,e){return await n.post(`deals/${s}/signer`,e)}async function R(s,e){const t=await n.get(`deals/${s}/transit/${e}`);return["negotiation"].includes(e)&&r(s),t}async function H(s,e){const t=await n.post(`deals/${s}/transit/canceled`,{cancellation_reason:e});return r(s),t}async function K(s){return await n.post(`deals/${s}/transit/confirmation`)}async function z(s,e){const t=await n.post(`deals/${s}/agreement/upload`,e);return c(s),t}async function E(s,e){if(!e.length)return m({title:"Внимание!",text:"Вы не добавили ни одной фотографии для загрузки на сервер",type:"warn"}),[];const t=await Promise.all([...e].map(a=>n.post(`deals/${s}/photos/upload`,{photo:a})));return await c(s),t}async function F(s,e){const t=Object.entries(e);if(!t.find(([p,i])=>i.length))return m({title:"Внимание!",text:"Вы не добавили ни одной фотографии для загрузки на сервер",type:"warn"}),[];const o=await Promise.all(t.map(async([p,i])=>[...i].map(async d=>await n.post(`deals/${s}/documents`,{type:p,photo:d}))));return setTimeout(()=>{c(s)},300),o}async function Q(s,e){return await n.post(`deals/${s}/photos/delete`,e)}async function U(s,e){return await n.post(`deals/${s}/documents/delete`,e)}async function G(s,e){return await n.post(`deals/${s}/agreement/delete`,e)}async function J(s,e){const t=await n.post(`deals/${s}/dkp`,e);return c(s),t}async function V(s,e){const t=await n.post(`deals/${s}/acceptance`,e);return c(s),t}async function W(s,e){const{inspection_date:t,inspection_time:a}=e;return await n.post(`deals/${s}/date`,{inspection_date:t,inspection_time:l(a).format("HH:mm")})}async function X(s,e){const t=await n.post(`deals/${s}/decision`,e);return r(s),t}async function Z(s,e){return await n.post(`deals/${s}/owner-data/account`,e)}async function I(s,e){const t=await n.post(`deals/${s}/payment/confirm`,{code:e});return t.success&&r(s),t}async function ss(s,e){return await n.post(`deals/${s}/transit/begin/confirm/manager`,{code:e})}async function es(s,e){const t=await n.post(`deals/${s}/transit/begin/confirm/customer`,{code:e});return r(s),t}async function ts(s,e){return await n.post(`deals/${s}/payment/confirm/manager`,{code:e})}async function as(s,e){const t=await n.post(`deals/${s}/payment/confirm/customer`,{code:e});return r(s),t}async function ns(s,e){const t=e?"1":"0",a=await n.post(`deals/${s}/keys-passed`,{keys_passed:t});return r(s),a}async function os(s,e){const t=e?"1":"0",a=await n.post(`deals/${s}/docs-passed`,{docs_passed:t});return r(s),a}export{B as A,z as B,G as C,J as D,Z as E,V as F,c as a,ns as b,os as c,ts as d,as as e,M as f,K as g,R as h,ss as i,es as j,X as k,I as l,r as m,L as n,x as o,H as p,j as q,N as r,F as s,U as t,E as u,Q as v,W as w,b as x,O as y,k as z};
