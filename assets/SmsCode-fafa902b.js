import{d as w,_ as p,g as i,k as _,f as m,a as C,m as h,c as y,p as T,j as g,t as E,F,B as v}from"./_plugin-vue_export-helper-4e0f1051.js";import{A as d}from"./Api-3d31057e.js";import{A as f}from"./index.es-55ebbfbf.js";import{C as l}from"./Cookies-c25692b0.js";import{p as S}from"./principalSetUser-1de61370.js";import{F as k}from"./FormInput-f5b5225b.js";const x=w({});const A={class:"cFormHeader"};function D(o,e,r,n,s,u){return m(),i("h2",A,[_(o.$slots,"default")])}const j=p(x,[["render",D],["__file","/var/www/inflow-auto-front-main/src/shared/components/FormHeader/FormHeader.vue"]]);function I(o){const e=new Date,r={domain:window.location.hostname,path:"/",expires:new Date(e.setMonth(e.getMonth()+1))};l.set("token",o.access_token,r),l.set("expires",o.expires_in,r),S(o.user)}async function z(o){o.phone=o.phone.replace("+7","");const e=await d.post("auth/login",o);return e.error&&f({title:"Внимание!",text:e.error,type:"error"}),e}async function P(o){o.phone=o.phone.replace("+7","");const e=await d.post("auth/sms-login",o),r=e.data;return e.error&&f({title:"Внимание!",text:e.error,type:"error"}),e.success&&r&&I(r),e}const V={components:{FormInput:k},props:{codeRequest:Function},emits:["update:modelValue"],setup(o,{emit:e}){const n=C(0),s=()=>{localStorage.setItem("countdownTimer",new Date)};localStorage.getItem("countdownTimer")||s();let u=localStorage.getItem("countdownTimer"),a=new Date(u).getTime();const t=()=>{const c=(new Date().getTime()-a)/1e3;c<60?(n.value=Math.floor(60-c),setTimeout(()=>{t()},50)):localStorage.removeItem("countdownTimer")};return t(),{countdownTimer:n,resendCode:()=>{s(),u=localStorage.getItem("countdownTimer"),a=new Date(u).getTime(),setTimeout(()=>{t()},10)}}},data(){return{code:"",showErrors:!1,errorResponse:void 0}}},$="SmsCode_timer_1691549853145",H={timer:$};function M(o,e,r,n,s,u){const a=h("FormInput");return m(),i(F,null,[y(a,{type:"tel",name:"code",modelValue:s.code,"onUpdate:modelValue":[e[0]||(e[0]=t=>s.code=t),e[1]||(e[1]=t=>o.$emit("update:modelValue",t))],label:"Код из СМС",showErrors:s.showErrors,errorResponse:s.errorResponse,isOffset:""},{required:T(()=>[v("Введите Код из СМС")]),_:1},8,["modelValue","showErrors","errorResponse"]),n.countdownTimer?(m(),i("p",{key:0,class:g(o.$style.timer)}," Код повторно можно запросить через: "+E(n.countdownTimer)+" с. ",3)):(m(),i("button",{key:1,type:"button",class:"p-link",onClick:e[2]||(e[2]=(...t)=>n.resendCode&&n.resendCode(...t))}," Запросить код"))],64)}const R={$style:H},G=p(V,[["render",M],["__cssModules",R],["__file","/var/www/inflow-auto-front-main/src/views/auth/components/SmsCode.vue"]]);export{j as F,G as S,P as a,z as p};
